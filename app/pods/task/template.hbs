<div class="main-section-body">
  <div class="task-title-saving">
    {{#if isSaving}}
      SAVING...
    {{/if}}
  </div>

  <div class="task-worker-select">
    {{#power-select
      searchEnabled=false
      options=users
      selected=data.user
      placeholder=(t 'models.attributes.task.unassigned')
      onchange=(action 'assignUser') as |user|
    }}
      {{user.username}}
    {{/power-select}}
  </div>

  {{input
    type="text"
    placeholder=(t 'models.attributes.task.name')
    class="assignment-title-field"
    autofocus=true
    value=data.name
  }}

  {{#if showDescriptionTextarea}}
    {{autosize-textarea
      placeholder=(capitalize (t 'models.attributes.task.description'))
      class="assignment-description-field"
      value=data.descriptionMarkdown
      focusOut=(action 'disableDescriptionEdit')
      change=(action 'updateDescription' value='target.value')
      keyDown=(action 'enableDescriptionEdit')
    }}
    <button type="button" onclick={{action 'disableDescriptionEdit'}} class="button">Save</button>
  {{else}}
    <div class="assignment-description" ondblclick={{action 'enableDescriptionEdit'}}>
      {{{data.descriptionHtml}}}
    </div>
    <button type="button" onclick={{action 'enableDescriptionEdit'}} class="button">Edit description</button>
  {{/if}}

  <div class="dependencies">
    <h2>Depends on:</h2>

    {{#each dependencies as |dependency|}}
      <div>
        {{dependency.text}}
        <button type="button" onclick={{route-action 'removeDependency' dependency.task}}>
          X
        </button>
      </div>
    {{/each}}

    {{#if elegibleDependencies}}
      {{#basic-dropdown
        renderInPlace=true as |dropdown|
      }}
        {{#each elegibleDependencies as |dependency|}}
          <div id="dependency-{{dependency.task.id}}" onclick={{action 'addDependency' dependency dropdown}}>
            <button type="button">
              {{dependency.text}}
            </button>
          </div>
        {{/each}}
      {{else}}
        Add dependency
      {{/basic-dropdown}}
    {{/if}}
  </div>

  <div class="comments">
    <h2>
      {{capitalize (t 'models.comment.other')}}:
    </h2>

    {{#each comments as |comment|}}
      {{task-comment
        model=comment
      }}
    {{/each}}

    {{comment-form
      action=(route-action 'saveComment')
    }}
  </div>
</div>
